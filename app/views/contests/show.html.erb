<h1>
    <%= @contest.name %>
</h1>

<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        <h4 class="panel-title">
          About
        </h4>
      </a>
    </div>
    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
        <table class="table table-striped">
            <tr>
                <th>Location</th>
                <th>Date</th>
                <th>Actions</th>
                <th></th>
            </tr>
            <tr>
                <td> <%= @contest.location %></td>
                <td> <%= @contest.date.strftime("%B %e, %Y %l:%M %p") %></td>
                <th> <%= link_to 'Edit', edit_contest_path(@contest)%>
                <% if @contest.date < Date.today #only past contests can be deleted %>
                <%= link_to 'Delete', @contest, :method => :delete, data: {confirm: "Are you sure?"} %>
                <% else %>
                Delete
                <% end %>
                </th>
            </tr>     
            </table>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingTwo">
      <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
        <h4 class="panel-title">
         Project Categories
        </h4>
      </a>
    </div>
    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
      <div class="panel-body">
        <h3>Project Categories</h3>
        
        <% @contest.categories.each do |category| %>
          <div id="accordion2" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
              <div class="panel-heading" role="tab" id="headingTwo<%= category.id %>">
                <a data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo<%= category.id %>" aria-expanded="false" aria-controls="collapseTwo<%= category.id %>">
                  <%= category.name %>
                  <h6 align="right">Total Projects: <%= @categories_projects[category.id].size %></h6>
                </a>
              </div>
              <div id="collapseTwo<%= category.id %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo<%= category.id %>">
                <div class="panel-body">
                  <table class="table table-striped">
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Location</th>
                        <th>Actions</th>
                    </tr>
                    <% if @categories_projects[category.id].size == 0 %>
                      <tr><td>No projects in this category</td></tr>
                    <% end %>
                    <% @categories_projects[category.id].each do |project| %>
                      <tr>
                        <th>
                          <%= project.name %>
                        </th>
                        <th>
                          <%= project.category ? project.category.name :  "No category"%>
                        </th>
                        <th>
                          <%= project.location %>
                        </th>
                        <th>
                          <%= link_to 'Edit', edit_contest_project_path(@contest, project)%>
                          <%= link_to 'Delete', [@contest, project], :method => :delete, data: {confirm: "Are you sure?"} %>
                        </th>
                      </tr>
                    <% end %>
                  </table>
                  <ul class="breadcrumb">
                    <li role="presentation"><%= link_to 'Edit Category Name', edit_contest_category_path(@contest, category)%></li>
                    <li role="presentation"><%= link_to 'Delete Category', [@contest, category], :method => :delete, data: {confirm: "Are you sure?"} %></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        <% end %>
        <br>
        <ul class="breadcrumb">
          <li role="presentation"><%= link_to 'New Category', new_contest_category_path(@contest,@category) %></li>
          <li role="presentation"><%= link_to 'New Project', new_contest_project_path(@contest) %></li>
          <li role="presentation"><%= link_to 'View Unassigned Projects', unassigned_projects_path(@contest) %></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingFour">
      <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
        <h4 class="panel-title">
          Question Types
        </h4>
      </a>
    </div>
    <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
      <div class="panel-body">
        <h3>Question Types</h3>
        
        <% @contest.question_types.each do |question_type| %>
          <div id="accordion4" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
              <div class="panel-heading" role="tab" id="headingFour<%= question_type.id %>">
                <a data-toggle="collapse" data-parent="#accordion4" href="#collapseFour<%= question_type.id %>" aria-expanded="false" aria-controls="collapseFour<%= question_type.id %>">
                  <%= question_type.question_type %>
                </a>
              </div>
              <div id="collapseFour<%= question_type.id %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour<%= question_type.id %>">
                <div class="panel-body">
                  <table class="table table-striped">
                    <tr>
                      <th>Question</th>
                      <th>Actions</th>
                    </tr>
                    <% question_type.questions.each do |question| %>
                      <tr>
                        <td><%= question.question %></td>
                        <td>
                          <%= link_to 'Edit', edit_contest_question_type_question_path(@contest, question_type, question)%>
                          <%= link_to 'Delete', [@contest, question_type, question], :method => :delete, data: {confirm: "Are you sure?"} %>
                        </td>
                      </tr>
                    <% end %>
                    <tr>
                      <td><%= link_to 'New Question', new_contest_question_type_question_path(@contest, question_type) %></td>
                      <td></td>
                    </tr>
                  </table>
                  <%= link_to 'Edit Question Type', edit_contest_question_type_path(@contest, question_type)%><br/>
                  <%= link_to 'Delete Question Type', [@contest, question_type], :method => :delete, data: {confirm: "Are you sure?"} %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
        <br>
        <%= link_to 'New Question Type', new_contest_question_type_path(@contest) %>
      </div>
    </div>
  </div>
</div>
<ol class="breadcrumb">
  <li role="presentation"><%= link_to 'Upload Projects File', new_contest_attachment_path(@contest) %></li>
  <li role="presentation"><%= link_to 'Add Judges to projects', controller: "users" %></li>
  <li role="presentation"><%= link_to 'Download Scores', controller: "scores" %></li>
  <li role="presentation"><%= link_to 'Judge Project Mapping', action:'show' , controller:'judges' %></li>
</ul>